<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Checkout</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: auto; }
    input, select, button { width: 100%; padding: 10px; margin-top: 10px; }
    #mpesa-fields { display: none; }
  </style>
</head>
<body>
  <h2>Finalizar Compra</h2>

  <input type="text" id="nome" placeholder="Nome completo" required>
  <input type="email" id="email" placeholder="Email" required>

  <select id="metodo" onchange="mostrarCamposPagamento()">
    <option value="">Escolha o método de pagamento</option>
    <option value="mpesa">Mpesa</option>
    <!-- Futuramente pode colocar BIM, cartão, etc -->
  </select>

  <div id="mpesa-fields">
    <input type="text" id="telefone" placeholder="Número Mpesa (ex: 84xxxxxxx)" maxlength="9">
  </div>

  <button onclick="pagar()">Pagar 30MT</button>

  <p id="resposta"></p>

  <script>
    function mostrarCamposPagamento() {
      const metodo = document.getElementById('metodo').value;
      document.getElementById('mpesa-fields').style.display = metodo === 'mpesa' ? 'block' : 'none';
    }

    async function pagar() {
      const nome = document.getElementById('nome').value;
      const email = document.getElementById('email').value;
      const telefone = document.getElementById('telefone').value;

      if (!nome || !email || !telefone) {
        alert('Por favor preencha todos os campos!');
        return;
      }

      const payload = {
        client_id: "teu-client-id",
        amount: "30",
        phone: telefone,
        reference: "PagamentoCheckout"
      };

      const headers = {
        Authorization: "Bearer teu_token_jwt",
        Accept: "application/json",
        "Content-Type": "application/json"
      };

      try {
        const response = await fetch("https://e2payments.explicador.co.mz/v1/c2b/mpesa-payment/teu_wallet_id", {
          method: "POST",
          headers,
          body: JSON.stringify(payload)
        });

        const data = await response.json();

        if (data.status === 'success' || data.message?.includes('success')) {
          // Redirecionar para página de obrigado
          window.location.href = "pagina-de-obrigado.html";
        } else {
          document.getElementById("resposta").innerText = "Erro no pagamento: " + JSON.stringify(data);
        }
      } catch (error) {
        document.getElementById("resposta").innerText = "Erro ao tentar pagar: " + error;
      }
    }
  </script>
</body>
</html>
